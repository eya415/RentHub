{% load static %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}" dir="{% if LANGUAGE_CODE == 'ar' %}rtl{% else %}ltr{% endif %}">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Your Cart | RentHub</title>
  <link rel="icon" href="{% static 'rental/images/favicon.ico' %}" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="{% static 'rental/css/style.css' %}">
  <style>
    :root {
      --primary-dark: #003322;
      --primary-accent: #ffa500;
      --primary-light: #f8f8f8;
      --danger: #dc3545;
      --success: #28a745;
      --warning: #ffc107;
      --text-dark: #222;
      --text-medium: #555;
      --text-light: #888;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
      --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
      --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
      --radius-sm: 6px;
      --radius-md: 12px;
      --radius-lg: 30px;
      --transition: all 0.3s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--primary-light);
      color: var(--text-dark);
      line-height: 1.6;
    }

    /* ░░░ NAVBAR ░░░ */
    .navbar {
      background: var(--primary-dark);
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 40px;
      flex-wrap: wrap;
      box-shadow: var(--shadow-md);
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .nav-left {
      display: flex;
      align-items: center;
    }

    .nav-left .logo {
      width: 50px;
      margin-right: 12px;
    }

    .nav-left h1 {
      font-size: 2rem;
      margin: 0;
      background: linear-gradient(to right, var(--primary-accent) 50%, white 50%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 800;
      letter-spacing: 1px;
    }

    .nav-links {
      list-style: none;
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      margin: 0;
      padding: 0;
    }

    .nav-links li a {
      text-decoration: none;
      padding: 10px 16px;
      border-radius: var(--radius-lg);
      color: white;
      font-weight: 600;
      transition: var(--transition);
      font-size: 0.95rem;
    }

    .nav-links li a:hover,
    .nav-links li a.nav-btn.active {
      background: var(--primary-accent);
      color: var(--primary-dark);
    }

    .dropdown-parent {
      position: relative;
    }

    .dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      display: none;
      background: white;
      color: var(--primary-dark);
      list-style: none;
      padding: 10px 0;
      border-radius: var(--radius-sm);
      box-shadow: var(--shadow-lg);
      z-index: 10;
      min-width: 200px;
    }

    .dropdown-parent:hover .dropdown {
      display: block;
    }

    .dropdown li a {
      color: var(--primary-dark);
      padding: 8px 20px;
      display: block;
      text-decoration: none;
      font-size: 0.9rem;
      transition: var(--transition);
    }

    .dropdown li a:hover {
      background: rgba(0, 51, 34, 0.1);
    }

    .hamburger {
      display: none;
      font-size: 1.8rem;
      cursor: pointer;
      color: white;
      padding: 5px;
    }

    .nav-cta {
      background-color: var(--primary-accent);
      color: var(--primary-dark);
      font-weight: 700;
      padding: 10px 18px;
      border-radius: var(--radius-lg);
      transition: var(--transition);
      text-align: center;
      margin-left: 15px;
      white-space: nowrap;
      font-size: 0.95rem;
    }

    .nav-cta:hover {
      background-color: #e69500;
      transform: translateY(-2px);
    }

    .desktop-only {
      display: inline-block;
    }

    @media (max-width: 992px) {
      .navbar {
        padding: 15px 20px;
      }
      
      .nav-left h1 {
        font-size: 1.8rem;
      }
    }

    @media (max-width: 768px) {
      .hamburger {
        display: block;
      }

      .nav-links {
        flex-direction: column;
        width: 100%;
        display: none;
        margin-top: 20px;
      }

      .nav-links.show {
        display: flex;
      }

      .desktop-only {
        display: none;
      }

      .dropdown-parent {
        width: 100%;
      }

      .dropdown {
        position: static;
        width: 100%;
        display: none;
        box-shadow: none;
        border-radius: 0;
        background: rgba(255, 255, 255, 0.1);
      }

      .dropdown li a {
        color: white;
        padding-left: 30px;
      }

      .dropdown-parent:hover .dropdown {
        display: block;
      }

      .nav-links li:last-child {
        margin-top: 15px;
      }

      .nav-links li:last-child a.nav-cta {
        display: block;
        width: 100%;
        padding: 10px 0;
        margin-left: 0;
      }
    }

    /* Auth Section */
    .auth-box {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-left: 20px;
    }

    .auth-welcome {
      font-size: 0.9rem;
      font-weight: 500;
      color: #ffffff;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .auth-link,
    .logout-btn {
      padding: 7px 18px;
      font-size: 0.85rem;
      font-weight: 700;
      background-color: transparent;
      color: var(--primary-accent);
      border: none;
      border-bottom: 2px solid transparent;
      text-decoration: none;
      cursor: pointer;
      transition: var(--transition);
      text-transform: uppercase;
      letter-spacing: 0.8px;
    }

    .auth-link:hover,
    .logout-btn:hover {
      color: #fff;
      border-bottom: 2px solid var(--primary-accent);
    }

    .auth-link.active {
      color: white;
      border-bottom: 2px solid var(--primary-accent);
    }

    .divider {
      width: 1px;
      height: 20px;
      background-color: var(--primary-accent);
      opacity: 0.6;
    }

    .logout-btn {
      padding: 0;
      background: none;
    }

    /* ░░░ CART SECTION ░░░ */
    .cart-section {
      padding: 60px 5%;
      max-width: 1200px;
      margin: 0 auto;
      min-height: calc(100vh - 200px);
    }

    .cart-section h1 {
      font-size: 2.5rem;
      text-align: center;
      color: var(--primary-dark);
      margin-bottom: 40px;
      position: relative;
      display: inline-block;
      width: 100%;
    }

    .cart-section h1::after {
      content: '';
      display: block;
      width: 80px;
      height: 4px;
      background: var(--primary-accent);
      margin: 15px auto 0;
      border-radius: 2px;
    }

    /* Messages */
    .message {
      text-align: center;
      padding: 15px 20px;
      margin-bottom: 30px;
      border-radius: var(--radius-sm);
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      animation: slideDown 0.5s ease-out;
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .success-message {
      background: #e6f7ee;
      color: var(--success);
      border: 1px solid #c3e6cb;
    }

    .error-message {
      background: #fdecea;
      color: var(--danger);
      border: 1px solid #f5c6cb;
    }

    /* Cart Items */
    .cart-items {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .cart-item {
      display: flex;
      background: white;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-sm);
      padding: 20px;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      transition: var(--transition);
      position: relative;
    }

    .cart-item:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }

    .cart-item-image {
      width: 120px;
      height: 120px;
      border-radius: var(--radius-sm);
      object-fit: cover;
      object-position: center;
    }

    .item-info {
      flex: 1;
      margin: 0 20px;
      min-width: 200px;
    }

    .item-info h2 {
      font-size: 1.2rem;
      margin: 0 0 10px;
      color: var(--primary-dark);
    }

    .item-info p {
      margin: 6px 0;
      font-size: 0.95rem;
      color: var(--text-medium);
    }

    .item-price {
      font-weight: 700;
      color: var(--primary-dark);
    }

    .item-subtotal {
      font-weight: 700;
      color: var(--primary-accent);
    }

    .item-actions {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      min-width: 180px;
    }

    .quantity-control {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }

    .quantity-control input[type="number"] {
      width: 60px;
      padding: 8px;
      margin: 0 10px;
      border-radius: var(--radius-sm);
      border: 1px solid #ddd;
      text-align: center;
      font-weight: 600;
      -moz-appearance: textfield;
    }

    .quantity-control input[type="number"]::-webkit-outer-spin-button,
    .quantity-control input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .quantity-btn {
      background: var(--primary-light);
      color: var(--primary-dark);
      border: none;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-weight: bold;
      transition: var(--transition);
    }

    .quantity-btn:hover {
      background: var(--primary-accent);
      color: white;
    }

    .update-btn {
      background: var(--primary-dark);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
      margin-bottom: 10px;
      width: 100%;
    }

    .update-btn:hover {
      background: #002a1c;
      transform: translateY(-2px);
    }

    .remove-btn {
      background: var(--danger);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
      width: 100%;
    }

    .remove-btn:hover {
      background: #c82333;
      transform: translateY(-2px);
    }

    /* Cart Summary */
    .cart-summary {
      background: white;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-sm);
      padding: 25px;
      margin-top: 40px;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      width: 100%;
      max-width: 300px;
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }

    .summary-row:last-child {
      border-bottom: none;
      margin-bottom: 20px;
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--primary-dark);
    }

    .cart-total {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary-dark);
      margin: 20px 0;
    }

    .checkout-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      background: var(--primary-dark);
      color: white;
      padding: 12px 30px;
      border-radius: var(--radius-lg);
      font-size: 1rem;
      text-decoration: none;
      font-weight: 700;
      transition: var(--transition);
      border: none;
      cursor: pointer;
    }

    .checkout-btn:hover {
      background: var(--primary-accent);
      color: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    /* Empty Cart */
    .empty-cart {
      text-align: center;
      padding: 60px 20px;
      background: white;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-sm);
      margin: 0 auto;
      max-width: 600px;
    }

    .empty-cart-icon {
      font-size: 4rem;
      color: var(--text-light);
      margin-bottom: 20px;
    }

    .empty-cart h3 {
      font-size: 1.5rem;
      color: var(--text-medium);
      margin-bottom: 20px;
    }

    .empty-cart p {
      color: var(--text-light);
      margin-bottom: 30px;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }

    .browse-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: var(--primary-dark);
      color: white;
      padding: 12px 24px;
      border-radius: var(--radius-lg);
      font-size: 1rem;
      text-decoration: none;
      font-weight: 600;
      transition: var(--transition);
    }

    .browse-btn:hover {
      background: var(--primary-accent);
      color: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    /* Responsive Adjustments */
    @media (max-width: 768px) {
      .cart-section {
        padding: 40px 20px;
      }
      
      .cart-section h1 {
        font-size: 2rem;
      }
      
      .cart-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 20px;
      }
      
      .cart-item-image {
        width: 100%;
        height: auto;
        max-height: 200px;
      }
      
      .item-info {
        margin: 0;
      }
      
      .item-actions {
        width: 100%;
        align-items: flex-start;
      }
      
      .quantity-control {
        margin-bottom: 15px;
      }
      
      .update-btn, .remove-btn {
        width: auto;
      }
      
      .cart-summary {
        align-items: flex-start;
      }
      
      .summary-row {
        max-width: 100%;
      }
    }

    /* Footer */
    footer {
      background-color: var(--primary-dark);
      color: white;
      text-align: center;
      padding: 2rem 1rem;
      margin-top: 4rem;
    }

    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .footer-logo {
      width: 60px;
      margin-bottom: 1rem;
    }

    .footer-links {
      display: flex;
      gap: 20px;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    .footer-links a {
      color: white;
      text-decoration: none;
      transition: var(--transition);
    }

    .footer-links a:hover {
      color: var(--primary-accent);
    }

    .social-links {
      display: flex;
      gap: 15px;
      margin-bottom: 1.5rem;
    }

    .social-links a {
      color: white;
      font-size: 1.2rem;
      transition: var(--transition);
    }

    .social-links a:hover {
      color: var(--primary-accent);
      transform: translateY(-3px);
    }

    .copyright {
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.7);
    }

    /* Loading Animation */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      display: none;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: var(--primary-accent);
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="spinner"></div>
</div>

<!-- Standardized Navbar -->
<nav class="navbar">
  <div class="nav-left">
    <img src="{% static 'rental/images/logo.png' %}" alt="Logo" class="logo">
    <h1>RENTHUB</h1>
  </div>
  <div class="hamburger" onclick="toggleMenu()"><i class="fas fa-bars"></i></div>
  <ul class="nav-links" id="menu">
    <li><a href="{% url 'home' %}" class="nav-btn {% if request.resolver_match.url_name == 'home' %}active{% endif %}">Home</a></li>
    <li><a href="{% url 'about' %}" class="nav-btn {% if request.resolver_match.url_name == 'about' %}active{% endif %}">About</a></li>
    <li><a href="{% url 'gallery' %}" class="nav-btn {% if request.resolver_match.url_name == 'gallery' %}active{% endif %}">Store</a></li>
    
    <!-- Account Dropdown -->
    <li class="dropdown-parent">
      <a href="#" class="nav-btn">My Account <i class="fas fa-caret-down"></i></a>
      <ul class="dropdown">
        {% if user.is_authenticated %}
          <li><a href="{% url 'cart' %}"><i class="fas fa-shopping-cart"></i> Cart</a></li>
          <li><a href="{% url 'wishlist' %}"><i class="fas fa-heart"></i> Wishlist</a></li>
          <li><a href="{% url 'checkout' %}"><i class="fas fa-credit-card"></i> Checkout</a></li>
          <li><a href="{% url 'my_orders' %}"><i class="fas fa-clipboard-list"></i> Orders</a></li>
        {% else %}
          <li><a href="{% url 'login' %}?next={% url 'cart' %}"><i class="fas fa-shopping-cart"></i> Cart</a></li>
          <li><a href="{% url 'login' %}?next={% url 'wishlist' %}"><i class="fas fa-heart"></i> Wishlist</a></li>
          <li><a href="{% url 'login' %}?next={% url 'checkout' %}"><i class="fas fa-credit-card"></i> Checkout</a></li>
          <li><a href="{% url 'login' %}?next={% url 'my_orders' %}"><i class="fas fa-clipboard-list"></i> Orders</a></li>
        {% endif %}
      </ul>
    </li>
    
    <li><a href="{% url 'contact' %}" class="nav-btn">Contact</a></li>
  </ul>
  
  <!-- Auth Section -->
  {% if user.is_authenticated %}
  <div class="auth-box desktop-only">
    <span class="auth-welcome">Hi, {{ user.username }}</span>
    <form method="POST" action="{% url 'logout' %}">
      {% csrf_token %}
      <button type="submit" class="logout-btn">Logout</button>
    </form>
  </div>
  {% else %}
  <div class="auth-box desktop-only">
    <a href="{% url 'login' %}" class="auth-link {% if request.resolver_match.url_name == 'login' %}active{% endif %}">Login</a>
    <span class="divider"></span>
    <a href="{% url 'register' %}" class="auth-link {% if request.resolver_match.url_name == 'register' %}active{% endif %}">Register</a>
  </div>
  {% endif %}
</nav>


<!-- ░░░ CART SECTION ░░░ -->
<section class="cart-section">
  <h1>Your Shopping Cart</h1>

  {% if messages %}
    {% for message in messages %}
      <div class="message {% if message.tags %}{{ message.tags }}{% endif %}">
        <i class="fas {% if message.tags == 'success' %}fa-check-circle{% else %}fa-exclamation-circle{% endif %}"></i>
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  {% if cart_items %}
  <div class="cart-items">
    {% for item in cart_items %}
    <div class="cart-item">
      <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" class="cart-item-image">
      <div class="item-info">
        <h2>{{ item.product.name }}</h2>
        <p class="item-price">Price: EGP{{ item.product.price|floatformat:2 }}</p>
        <p class="item-subtotal">Subtotal: EGP{{ item.subtotal|floatformat:2 }}</p>
      </div>
      <div class="item-actions">
        <form method="post" action="{% url 'update_cart' item.product.id %}" class="update-form">
          {% csrf_token %}
          <div class="quantity-control">
            <button type="button" class="quantity-btn minus-btn" data-product-id="{{ item.product.id }}">-</button>
            <input type="number" name="quantity" value="{{ item.quantity }}" min="1" class="quantity-input" data-product-id="{{ item.product.id }}">
            <button type="button" class="quantity-btn plus-btn" data-product-id="{{ item.product.id }}">+</button>
          </div>
          <button type="submit" class="update-btn">Update Quantity</button>
        </form>
        <form method="post" action="{% url 'remove_from_cart' item.product.id %}" class="remove-form">
          {% csrf_token %}
          <button type="submit" class="remove-btn">
            <i class="fas fa-trash-alt"></i> Remove Item
          </button>
        </form>
      </div>
    </div>
    {% endfor %}
  </div>

  <div class="cart-summary">
    <div class="summary-row">
      <span>Subtotal:</span>
      <span>EGP{{ subtotal|floatformat:2 }}</span>
    </div>
    <div class="summary-row">
      <span>Delivery Fee:</span>
      <span>EGP{{ delivery_fee|floatformat:2 }}</span>
    </div>
    <div class="summary-row">
      <span>Total:</span>
      <span>EGP{{ total|floatformat:2 }}</span>
    </div>
    <a href="{% url 'checkout' %}" class="checkout-btn">
      <i class="fas fa-credit-card"></i> Proceed to Checkout
    </a>
  </div>

  {% else %}
  <div class="empty-cart">
    <div class="empty-cart-icon">
      <i class="fas fa-shopping-cart"></i>
    </div>
    <h3>Your cart is empty</h3>
    <p>Looks like you haven't added any items to your cart yet. Start shopping to find amazing products!</p>
    <a href="{% url 'gallery' %}" class="browse-btn">
      <i class="fas fa-store"></i> Browse Products
    </a>
  </div>
  {% endif %}
</section>

<!-- Footer -->
<footer>
  <div class="footer-content">
    <img src="{% static 'rental/images/logo-white.png' %}" alt="RentHub Logo" class="footer-logo">
    <div class="footer-links">
      <a href="{% url 'home' %}">Home</a>
      <a href="{% url 'about' %}">About</a>
      <a href="{% url 'gallery' %}">Gallery</a>
      <a href="{% url 'contact' %}">Contact</a>
      
    </div>
    <div class="social-links">
      <a href="#"><i class="fab fa-facebook-f"></i></a>
      <a href="#"><i class="fab fa-twitter"></i></a>
      <a href="#"><i class="fab fa-instagram"></i></a>
      <a href="#"><i class="fab fa-linkedin-in"></i></a>
    </div>
    <p class="copyright">&copy; {% now "Y" %} RentHub. All rights reserved.</p>
  </div>
</footer>

<script>
  // Mobile menu toggle
  function toggleMenu() {
    const menu = document.getElementById('menu');
    menu.classList.toggle('show');
  }

  // Quantity controls
  document.addEventListener('DOMContentLoaded', function() {
    // Plus button
    document.querySelectorAll('.plus-btn').forEach(button => {
      button.addEventListener('click', function() {
        const productId = this.getAttribute('data-product-id');
        const input = document.querySelector(`.quantity-input[data-product-id="${productId}"]`);
        input.value = parseInt(input.value) + 1;
      });
    });

    // Minus button
    document.querySelectorAll('.minus-btn').forEach(button => {
      button.addEventListener('click', function() {
        const productId = this.getAttribute('data-product-id');
        const input = document.querySelector(`.quantity-input[data-product-id="${productId}"]`);
        if (parseInt(input.value) > 1) {
          input.value = parseInt(input.value) - 1;
        }
      });
    });

    // Form submission loading indicator
    document.querySelectorAll('form').forEach(form => {
      form.addEventListener('submit', function() {
        document.getElementById('loadingOverlay').style.display = 'flex';
      });
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', function(event) {
      if (!event.target.closest('.dropdown-parent')) {
        document.querySelectorAll('.dropdown').forEach(dropdown => {
          dropdown.style.display = 'none';
        });
      }
    });
  });
</script>
</body>
</html>